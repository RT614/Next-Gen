<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Next Gen Escape Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #111; color: #eee; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        .question { margin-bottom: 20px; }
        .leaderboard { margin-top: 40px; border-top: 1px solid #444; padding-top: 20px; }
        input, button { padding: 10px; margin-top: 10px; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #444; padding: 8px; text-align: left; }
        label { display: block; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Escape the OSS Laboratory</h1>
        <p>Answer all 10 trivia questions to escape. Good luck!</p>

        <div id="game">
            <label for="playerName">Enter your name:</label>
            <input type="text" id="playerName" placeholder="Your name">
            <button onclick="startGame()">Start Game</button>
        </div>

        <div id="questionArea" style="display:none;"></div>
        <div id="leaderboard" class="leaderboard">
            <h2>Leaderboard</h2>
            <table>
                <thead>
                    <tr><th>Name</th><th>Correct</th><th>Time</th><th>Timestamp</th><th>GameTitle</th></tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
            </table>
            <button onclick="downloadExcel()">Download Leaderboard as Excel</button>
        </div>
    </div>

    <script>
        const questions = [
            { q: "Which iPhone introduces the first square front camera sensor with Center Stage?", options: ["iPhone 17", "iPhone Air", "iPhone 17 Pro", "iPhone 17 Pro Max", "All"], a: "All" },
            { q: "What is the max resolution of the iPhone 17 front camera?", options: ["12MP", "16MP", "18MP", "20MP"], a: "18MP" },
            { q: "Which iPhone has a 6.5-inch display and titanium frame?", options: ["iPhone 17", "iPhone Air", "iPhone 17 Pro", "iPhone 17 Pro Max"], a: "iPhone Air" },
            { q: "What chip powers the iPhone Air?", options: ["A18", "A19 Pro", "A17 Bionic", "M1"], a: "A19 Pro" },
            { q: "Which iPhone supports Dual Capture video?", options: ["iPhone 17", "iPhone Air", "iPhone 17 Pro", "iPhone 17 Pro Max", "All"], a: "All" },
            { q: "What is the refresh rate of the iPhone 17 display?", options: ["60Hz", "90Hz", "120Hz", "144Hz"], a: "120Hz" },
            { q: "Which iPhone has a vapor chamber cooling system?", options: ["iPhone 17", "iPhone Air", "iPhone 17 Pro", "iPhone 16 Pro Max"], a: "iPhone 17 Pro" },
            { q: "What is the starting price of iPhone 17 Pro 256GB?", options: ["$999.99", "$1,099.99", "$1,199.99", "$1,299.99"], a: "$1,099.99" },
            { q: "Which Apple Watch is the newest Ultra model?", options: ["Apple Watch Series 11", "Apple Watch SE3", "Apple Watch Ultra 3", "Apple Watch Ultra 2"], a: "Apple Watch Ultra 3" },
            { q: "Which AirPods model was announced?", options: ["AirPods 2", "AirPods Pro 2", "AirPods Pro 3", "AirPods Max"], a: "AirPods Pro 3" }
        ];

        let current = 0;
        let correct = 0;
        let startTime;

        function startGame() {
            const name = document.getElementById("playerName").value;
            if (!name) return alert("Please enter your name.");
            startTime = new Date();
            document.getElementById("game").style.display = "none";
            document.getElementById("questionArea").style.display = "block";
            showQuestion();
        }

        function showQuestion() {
            const q = questions[current];
            let optionsHtml = "";
            q.options.forEach((opt, index) => {
                optionsHtml += `<label><input type='radio' name='answer' value='${opt}'> ${String.fromCharCode(65 + index)}. ${opt}</label>`;
            });
            document.getElementById("questionArea").innerHTML = `
                <div class='question'>
                    <p><strong>Question ${current + 1}:</strong> ${q.q}</p>
                    ${optionsHtml}
                    <button onclick='submitAnswer()'>Submit</button>
                </div>
            `;
        }

function submitAnswer() {
  const selected = document.querySelector("input[name='answer']:checked");
  if (!selected) return alert("Select an answer");

  const correctAnswer = questions[current].a;
  const allOptions = document.querySelectorAll("input[name='answer']");

if (selected.value === correctAnswer) {
  correct++; // âœ… increment correct answers
}

  allOptions.forEach(option => {
    option.disabled = true; // prevent further changes
    if (option.value === correctAnswer) {
      option.parentElement.style.backgroundColor = "#2ecc71"; // green for correct
    } else if (option.checked) {
      option.parentElement.style.backgroundColor = "#e74c3c"; // red for wrong
    }
  });

  // Add a delay before moving to the next question
  setTimeout(() => {
    current++;
    if (current < questions.length) {
      showQuestion();
    } else {
      endGame();
    }
  }, 1500); // 1.5 seconds delay
}

        function endGame() {
            const endTime = new Date();
            const timeTaken = new Date(endTime - startTime).toISOString().substr(11, 8);
            const timestamp = endTime.toLocaleString();
            const name = document.getElementById("playerName").value;
             const gameTitle = document.querySelector("title").innerText;
            const entry = { name, correct, timeTaken, timestamp, gameTitle };
            let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
            leaderboard.push(entry);
            localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
            displayLeaderboard();
        }

        function displayLeaderboard() {
            document.getElementById("questionArea").style.display = "none";
            document.getElementById("leaderboard").style.display = "block";
            const leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
            const tbody = document.getElementById("leaderboardBody");
            tbody.innerHTML = "";
            leaderboard.forEach(entry => {
                tbody.innerHTML += `<tr><td>${entry.name}</td><td>${entry.correct}</td><td>${entry.timeTaken}</td><td>${entry.timestamp}</td><td>${entry.gameTitle || "Next Gen Escape Room"}</td></tr>`;
            });
        }

        function downloadExcel() {
            const leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
            const worksheet = XLSX.utils.json_to_sheet(leaderboard);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Leaderboard");
            XLSX.writeFile(workbook, "escape_room_leaderboard.xlsx");
        }

        window.onload = displayLeaderboard;
    </script>
</body>
</html>
